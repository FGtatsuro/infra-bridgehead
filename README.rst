==================================================
infra-bridgehead
==================================================

|Build Status|

This project generates the base image for various infrastructures.

It is mainly used for infrastructure testing on CI.
The contents it includes are  as follows.

- Python(>= 2.7.9) (For Ansible)
- Ruby(>= 2.0) (For Serverspec only if building image including tasks with 'ruby' tag)

Supported image platforms are here.

- Docker
  - Debian
  - Alpine Linux

Requirements
------------

The dependencies on other softwares/librarys for this project.

Supported build environments are here.

- Ubuntu(>= 14.04)
    - Python (2.7.x)
- OSX(>= 10.9.5)
    - Python (2.7.x)
    - Homebrew (>= 0.9.5)

How to
------

1. Setup build environment.

.. code:: bash

    $ pip install -r requirements.txt
    $ ansible-galaxy install -r role_requirements.yml
    $ ansible-playbook playbooks/buildenv.yml -i inventory/default -l buildenv

2. Build base image.

.. code:: bash

    $ ansible-playbook playbooks/base.yml -i inventory/default -l container \
      --tags "python" \
      --extra-vars="docker_base_image=debian:jessie docker_commit_image=fgtatsuro/infra-bridgehead:debian-jessie"

3. If you want to upload the image, you need to use the way for each image type.

.. code:: bash

    # Docker
    $ docker login -e="$DOCKER_EMAIL" -u="$DOCKER_USERNAME" -p="$DOCKER_PASSWORD"
    $ docker push fgtatsuro/infra-bridgehead:debian-jessie

Notes
-----

The images generated by this project include packages related to development tools/headers.
For example,

- python-dev
- ruby-dev
- build-essential(Debian)/build-base(Alpine Linux)

This is because I assume that the images are used for not only single role(ex. container having only one feature),
but also multi roles(ex. Jenkins slave testing multiple features with several dependencies).
In this case, development tools/headers will be needed several times,
and the time they are no longer needed depends on the projects which use the images.

Thus, this project delegates the responsibility clearing such contents to users.

.. |Build Status| image:: https://travis-ci.org/FGtatsuro/infra-bridgehead.svg?branch=master
   :target: https://travis-ci.org/FGtatsuro/infra-bridgehead
