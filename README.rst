==================================================
infra-bridgehead
==================================================

|Build Status|

This project generates the base image for various infrastructures by Packer()

It is mainly used for infrastructure testing on CI.
The contents it includes are  as follows.

- Python(>= 2.7.9) (For Ansible)
- Ansible(>=2.0) (For Ansible Local Provisioner of Packer_)
- Ruby(>= 2.0) (For Serverspec)

Supported image platforms are here.

- Docker
  - Debian
  - Alpine Linux

Requirements
------------

The dependencies on other softwares/librarys for this project.

Supported build environments are here.

- Ubuntu(>= 14.04)
    - Python (2.7.x)
- OSX(>= 10.9.5)
    - Python (2.7.x)
    - Homebrew (>= 0.9.5)

How to
------

1. Setup Packer build environment.

.. code:: bash

    $ pip install -r requirements.txt
    $ ansible-galaxy install -r role_requirements.yml
    $ ansible-playbook playbooks/buildenv.yml -i inventory/default -l buildenv

2. Build base image.

.. code:: bash

    $ packer build platforms/docker/debian.json

3. If you want to upload the image, you need to use the way for each image type.

.. code:: bash

    # Docker
    $ docker login -e="$DOCKER_EMAIL" -u="$DOCKER_USERNAME" -p="$DOCKER_PASSWORD"
    $ docker push fgtatsuro/infra-bridgehead:debian-jessie

Notes
-----

The images generated by this project include packages related to development tools/headers.
For example,

- Ansible, and libraries it depends on
- python-dev
- ruby-dev
- build-essential(Debian)/build-base(Alpine Linux)

This is because I assume that the images are used for not only single role(ex. container having only one feature),
but also multi roles(ex. innternal server on real machine).
In this case, development tools/headers will be needed several times,
and the time they are no longer needed depends on the projects which use the images.

Thus, this project delegates the responsibility clearing such contents to users.

.. |Build Status| image:: https://travis-ci.org/FGtatsuro/infra-bridgehead.svg?branch=master
   :target: https://travis-ci.org/FGtatsuro/infra-bridgehead

.. _Packer: https://github.com/mitchellh/packer
